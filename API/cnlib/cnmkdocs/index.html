<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>cnmkdocs.py - CNLib</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">CNLib</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Cnlib</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../cnformatter/" class="dropdown-item">cnformatter.py</a>
</li>
            
<li>
    <a href="../cnfunctions/" class="dropdown-item">cnfunctions.py</a>
</li>
            
<li>
    <a href="../cninstall/" class="dropdown-item">cninstall.py</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active" aria-current="page">cnmkdocs.py</a>
</li>
            
<li>
    <a href="../cnpot/" class="dropdown-item">cnpot.py</a>
</li>
            
<li>
    <a href="../cntree/" class="dropdown-item">cntree.py</a>
</li>
            
<li>
    <a href="../cnvenv/" class="dropdown-item">cnvenv.py</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../cninstall/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../cnpot/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#cnmkdocspy" class="nav-link">cnmkdocs.py</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#cnlib.cnmkdocs" class="nav-link">cnmkdocs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#cnlib.cnmkdocs.CNMkDocs" class="nav-link">CNMkDocs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="cnmkdocspy">cnmkdocs.py</h1>


<div class="doc doc-object doc-module">



<a id="cnlib.cnmkdocs"></a>
    <div class="doc doc-contents first">

        <p>This module makes documentation for a project using MkDocs. It uses the
project's source files and the config file "mkdocs.yml" to create MarkDown
files in the "docs" folder. It then builds the html file structure in the
"site" folder. It uses the "gh-deploy" program to publish the site to a
remote-only branch. It then instructs GitHub Pages to auto-publish your docs at
<username>.github.io/<repo_name> from that branch.
As much code/settings/constants as can be are reused from conf.py.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="cnlib.cnmkdocs.CNMkDocs" class="doc doc-heading">
            <code>CNMkDocs</code>


</h2>


    <div class="doc doc-contents ">


        <p>A class to handle making and baking documentation</p>







              <details class="quote">
                <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
                <pre class="highlight"><code class="language-python">class CNMkDocs:
    """
    A class to handle making and baking documentation
    """

    # --------------------------------------------------------------------------
    # Class constants
    # --------------------------------------------------------------------------

    # cmd for mkdocs
    # NB: format params are path to pp, path to pp venv, and path to project
    # S_CMD_DOC_BUILD = "cd {};. {}/bin/activate;cd {};mkdocs build"
    # cmd for mkdocs
    # NB: format params are path to pp, path to pp venv, and path to project
    S_CMD_DOC_DEPLOY = "cd {};. {}/bin/activate;cd {};mkdocs gh-deploy"

    # file ext for in/out
    S_EXT_IN = ".py"
    S_EXT_OUT = ".md"

    # default to include mkdocstrings content in .md file
    # NB: format params are file name and formatted pkg name, done in make_docs
    S_DEF_FILE = "# {}\n::: {}"

    # name used by mkdocs (DO NOT CHANGE!!!)
    S_DIR_DOCS = "docs"
    S_DIR_SITE = "site"
    S_INDEX_NAME = "index.md"
    S_DIR_IMG = "img"

    # default encoding
    S_ENCODING = "UTF-8"

    # --------------------------------------------------------------------------
    # Class methods
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Initialize the new object
    # --------------------------------------------------------------------------
    def __init__(self):
        """
        Initialize the new object

        Initializes a new instance of the class, setting the default values
        of its properties, and any other code that needs to run to create a
        new object.

        Arguments:
            Numerous and belligerent
        """

        # set all properties from params
        # self._dir_name_small = ""
        # self._dir_prj = ""
        # self._dict_prv = ""
        # self._dir_docs = ""
        # self._dir_api = ""
        # self._skip_all = ""
        # self._skip_contents = ""
        # self._use_rm = ""
        # self._use_api = ""
        # self._p_dir_pp = ""
        # self._p_dir_pp_venv = ""
        # self._path_readme = ""
        # self._dir_img = ""

    # --------------------------------------------------------------------------
    # Public functions
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Make docs using mkdocs
    # --------------------------------------------------------------------------
    def make_docs(
        self,
        dir_prj,
        #
        use_rm=False,
        use_api=False,
        lst_api_in=None,
        file_rm=None,
        dir_api_out=None,
        dir_img=None,
    ):
        """
        Make docs using mkdocs

        Raises:
            cnlib.cnfunctions.CNRunError: If function fails

        Make the documents structure using the specified properties.
        """

        # NB: mutable lists are only set once, passing an empty list does
        # NUSSING!!!
        # so we pass None to make sure the internal list gets reset
        if not lst_api_in:
            lst_api_in = []

        # ----------------------------------------------------------------------
        # check docs dir for exist

        # find docs dir
        dir_docs = Path(dir_prj) / self.S_DIR_DOCS

        # no docs folder in template
        if not dir_docs.exists():

            # make dir
            dir_docs.mkdir(parents=True)

        # ----------------------------------------------------------------------
        # make index

        # make empty or from readme or don't touch
        self._make_index(dir_prj, use_rm, file_rm)

        # ----------------------------------------------------------------------
        # make api

        # make new api or delete old
        self._make_api(dir_prj, use_api, lst_api_in, dir_api_out)

        # ----------------------------------------------------------------------
        # make img dir

        # dir_img is source (from project main)
        if dir_img:
            # make new img dir or combine
            dir_img_src = Path(dir_prj) / dir_img
            if dir_img_src.exists():
                dir_img_dst = dir_docs / self.S_DIR_IMG
                shutil.copytree(dir_img_src, dir_img_dst, dirs_exist_ok=True)

    # --------------------------------------------------------------------------
    # Bake docs using mkdocs
    # --------------------------------------------------------------------------
    def bake_docs(
        self,
        dir_prj,
        #
        p_dir_pp,
        p_dir_pp_venv,
    ):
        """
        Bake docs using mkdocs

        Raises:
            cnlib.cnfunctions.CNRunError if bake fails

        Updates and deploys docs using mkdocs.
        """

        # # ----------------------------------------------------------------------
        # # do all the build stuff
        # self.make_docs(
        #     dir_prj, use_rm, use_api, lst_api_in, file_rm, dir_api_out, dir_img
        # )

        # ----------------------------------------------------------------------
        # deploy docs

        # format cmd using pdoc template dir, output dir, and start dir
        cmd_docs = self.S_CMD_DOC_DEPLOY.format(
            p_dir_pp,
            p_dir_pp_venv,
            dir_prj,
        )

        # the command to run mkdocs
        try:
            F.run(cmd_docs, shell=True)
        except F.CNRunError as e:
            raise e

    # --------------------------------------------------------------------------
    # Private functions
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Make the home file (index.md)
    # --------------------------------------------------------------------------
    def _make_index(self, dir_prj, use_rm, file_rm):
        """
        Make the home file (index.md)

        Make the index.md file from the README.
        """

        # first check if index exists
        dir_docs_out = Path(dir_prj) / self.S_DIR_DOCS
        path_index = dir_docs_out / self.S_INDEX_NAME

        # if not exist
        if not path_index.exists():

            # create empty file
            if not use_rm:
                with open(path_index, "w", encoding=self.S_ENCODING) as a_file:
                    a_file.write("Coming soon...")
                return

        # if exist
        else:

            # leave alone
            if not use_rm:
                return

        # ----------------------------------------------------------------------
        # make home page
        # NB: just copy readme.md to index.md
        if use_rm:

            # path to files
            readme_file = Path(dir_prj) / file_rm

            # read input file
            text = ""
            with open(readme_file, "r", encoding=self.S_ENCODING) as a_file:
                text = a_file.read()

            # write file
            with open(path_index, "w", encoding=self.S_ENCODING) as a_file:
                a_file.write(text)

    # --------------------------------------------------------------------------
    # Make the api files
    # --------------------------------------------------------------------------
    def _make_api(self, dir_prj, use_api, lst_api_in, dir_api_out):
        """
        Make the api files

        Make the documents using the specified parameters.
        """

        # sanity check
        if not dir_api_out:
            return

        # find api dir
        dir_prj = Path(dir_prj)
        dir_docs_out = dir_prj / self.S_DIR_DOCS
        dir_api_out = dir_docs_out / dir_api_out

        # nuke it if it exists and we changed out mind
        if not use_api and dir_api_out.exists():
            shutil.rmtree(dir_api_out)
            return

        # ----------------------------------------------------------------------

        # gather list of full paths to .py files
        files_out = []

        for item in lst_api_in:

            dir_api = dir_prj / item

            # NB: root is a full path, dirs and files are relative to root
            for root, _root_dirs, root_files in dir_api.walk():

                # convert files into Paths
                files = [root / f for f in root_files]
                files = [
                    f
                    for f in files
                    if f.suffix.lower() == self.S_EXT_IN.lower()
                ]

                # for each file item
                for item in files:
                    files_out.append(item)

        # ----------------------------------------------------------------------
        # make structure

        # nuke / remake the api folder
        if dir_api_out.exists():

            # delete and recreate dir
            shutil.rmtree(dir_api_out)
            dir_api_out.mkdir(parents=True)

        # for each py file
        for f in files_out:

            # make a parent folder in docs (goes in nav bar)
            # NB: basically we find every .py file and get its path relative to
            # project dir
            # then we make a folder with the same relative path, but rel to docs
            # dir
            path_rel = f.relative_to(dir_prj)
            path_doc = dir_api_out / path_rel.parent
            path_doc.mkdir(parents=True, exist_ok=True)

            # create a default file
            # NB: just swap ".py" ext for ".md"
            file_md = path_doc / Path(str(f.stem) + self.S_EXT_OUT)

            # fix rel path into package dot notation
            s_parts = ".".join(path_rel.parts)
            if s_parts.endswith(self.S_EXT_IN):
                s_parts = s_parts.removesuffix(self.S_EXT_IN)

            # format contents of file
            file_fmt = self.S_DEF_FILE.format(f.name, s_parts)
            with open(file_md, "w", encoding=self.S_ENCODING) as a_file:
                a_file.write(file_fmt)</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cnlib.cnmkdocs.CNMkDocs.__init__" class="doc doc-heading">
            <code class="highlight language-python">__init__()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the new object</p>
<p>Initializes a new instance of the class, setting the default values
of its properties, and any other code that needs to run to create a
new object.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
              <pre class="highlight"><code class="language-python">def __init__(self):
    """
    Initialize the new object

    Initializes a new instance of the class, setting the default values
    of its properties, and any other code that needs to run to create a
    new object.

    Arguments:
        Numerous and belligerent
    """</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cnmkdocs.CNMkDocs.bake_docs" class="doc doc-heading">
            <code class="highlight language-python">bake_docs(dir_prj, p_dir_pp, p_dir_pp_venv)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Bake docs using mkdocs</p>
        <p>Updates and deploys docs using mkdocs.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
              <pre class="highlight"><code class="language-python">def bake_docs(
    self,
    dir_prj,
    #
    p_dir_pp,
    p_dir_pp_venv,
):
    """
    Bake docs using mkdocs

    Raises:
        cnlib.cnfunctions.CNRunError if bake fails

    Updates and deploys docs using mkdocs.
    """

    # # ----------------------------------------------------------------------
    # # do all the build stuff
    # self.make_docs(
    #     dir_prj, use_rm, use_api, lst_api_in, file_rm, dir_api_out, dir_img
    # )

    # ----------------------------------------------------------------------
    # deploy docs

    # format cmd using pdoc template dir, output dir, and start dir
    cmd_docs = self.S_CMD_DOC_DEPLOY.format(
        p_dir_pp,
        p_dir_pp_venv,
        dir_prj,
    )

    # the command to run mkdocs
    try:
        F.run(cmd_docs, shell=True)
    except F.CNRunError as e:
        raise e</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cnmkdocs.CNMkDocs.make_docs" class="doc doc-heading">
            <code class="highlight language-python">make_docs(dir_prj, use_rm=False, use_api=False, lst_api_in=None, file_rm=None, dir_api_out=None, dir_img=None)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Make docs using mkdocs</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CNRunError (cnlib.cnfunctions.CNRunError)" href="../cnfunctions/#cnlib.cnfunctions.CNRunError">CNRunError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If function fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Make the documents structure using the specified properties.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
              <pre class="highlight"><code class="language-python">def make_docs(
    self,
    dir_prj,
    #
    use_rm=False,
    use_api=False,
    lst_api_in=None,
    file_rm=None,
    dir_api_out=None,
    dir_img=None,
):
    """
    Make docs using mkdocs

    Raises:
        cnlib.cnfunctions.CNRunError: If function fails

    Make the documents structure using the specified properties.
    """

    # NB: mutable lists are only set once, passing an empty list does
    # NUSSING!!!
    # so we pass None to make sure the internal list gets reset
    if not lst_api_in:
        lst_api_in = []

    # ----------------------------------------------------------------------
    # check docs dir for exist

    # find docs dir
    dir_docs = Path(dir_prj) / self.S_DIR_DOCS

    # no docs folder in template
    if not dir_docs.exists():

        # make dir
        dir_docs.mkdir(parents=True)

    # ----------------------------------------------------------------------
    # make index

    # make empty or from readme or don't touch
    self._make_index(dir_prj, use_rm, file_rm)

    # ----------------------------------------------------------------------
    # make api

    # make new api or delete old
    self._make_api(dir_prj, use_api, lst_api_in, dir_api_out)

    # ----------------------------------------------------------------------
    # make img dir

    # dir_img is source (from project main)
    if dir_img:
        # make new img dir or combine
        dir_img_src = Path(dir_prj) / dir_img
        if dir_img_src.exists():
            dir_img_dst = dir_docs / self.S_DIR_IMG
            shutil.copytree(dir_img_src, dir_img_dst, dirs_exist_ok=True)</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
