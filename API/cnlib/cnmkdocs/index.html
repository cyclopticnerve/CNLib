<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>cnmkdocs.py - CNLib</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "cnmkdocs.py";
        var mkdocs_page_input_path = "API/cnlib/cnmkdocs.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> CNLib
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Cnlib</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../cnformatter/">cnformatter.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cnfunctions/">cnfunctions.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cninstall/">cninstall.py</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">cnmkdocs.py</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#cnlib.cnmkdocs">cnmkdocs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cnlib.cnmkdocs.CNMkDocs">CNMkDocs</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cnlib.cnmkdocs.CNMkDocs.__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cnlib.cnmkdocs.CNMkDocs.build_docs">build_docs</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cnlib.cnmkdocs.CNMkDocs.deploy_docs">deploy_docs</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cnlib.cnmkdocs.CNMkDocs.make_docs">make_docs</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cnpot/">cnpot.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cntree/">cntree.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cnvenv/">cnvenv.py</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">CNLib</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API</li>
          <li class="breadcrumb-item">Cnlib</li>
      <li class="breadcrumb-item active">cnmkdocs.py</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cnmkdocspy">cnmkdocs.py</h1>


<div class="doc doc-object doc-module">



<a id="cnlib.cnmkdocs"></a>
    <div class="doc doc-contents first">

        <p>This module makes documentation for a project using MkDocs. It uses the
project's source files and the config file "mkdocs.yml" to create MarkDown
files in the "docs" folder. It then builds the html file structure in the
"site" folder. It uses the "gh-deploy" program to publish the site to a
remote-only branch. It then instructs GitHub Pages to auto-publish your docs at
&lt;username&gt;.github.io/&lt;repo_name&gt; from that branch.
As much code/settings/constants as can be are reused from conf.py.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="cnlib.cnmkdocs.CNMkDocs" class="doc doc-heading">
            <code>CNMkDocs</code>


</h2>


    <div class="doc doc-contents ">


        <p>A class to handle making and baking documentation</p>







              <details class="quote">
                <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
                <pre class="highlight"><code class="language-python">class CNMkDocs:
    """
    A class to handle making and baking documentation
    """

    # --------------------------------------------------------------------------
    # Class constants
    # --------------------------------------------------------------------------

    # cmd for mkdocs
    # NB: format params are path to pp, path to pp venv, and path to project
    S_CMD_DOC_BUILD = ". {}/bin/activate;cd {};mkdocs build"
    # cmd for mkdocs
    # NB: format params are path to pp, path to pp venv, and path to project
    S_CMD_DOC_DEPLOY = ". {}/bin/activate;cd {};mkdocs gh-deploy"

    # file ext for in/out
    S_EXT_IN = ".py"
    S_EXT_OUT = ".md"

    # default to include mkdocstrings content in .md file
    # NB: format params are file name and formatted pkg name, done in make_docs
    S_DEF_FILE = "# {}\n::: {}"

    # default encoding
    S_ENCODING = "UTF-8"

    # --------------------------------------------------------------------------
    # Class methods
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Initialize the new object
    # --------------------------------------------------------------------------
    def __init__(self):
        """
        Initialize the new object

        Initializes a new instance of the class, setting the default values
        of its properties, and any other code that needs to run to create a
        new object.
        """

        # NB: DO NOT CHANGE!!!
        self._index_name = "index.md"
        self._dir_img = "img"

    # --------------------------------------------------------------------------
    # Public functions
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Make docs using mkdocs
    # --------------------------------------------------------------------------
    def make_docs(
        self,
        dir_prj,
        dir_docs,
        use_rm=False,
        use_api=False,
        lst_api_in=None,
        file_rm=None,
        dir_api_out=None,
        dir_img=None,
    ):
        """
        Docstring for make_docs

        :param self: Description
        :param dir_prj: Description
        :param use_rm: Description
        :param use_api: Description
        :param lst_api_in: Description
        :param file_rm: Description
        :param dir_api_out: Description
        :param dir_img: Description
        """

        # NB: mutable lists are only set once, passing an empty list does
        # NUSSING!!!
        # so we pass None to make sure the internal list gets reset
        if not lst_api_in:
            lst_api_in = []

        # ----------------------------------------------------------------------
        # check docs dir for exist

        # find docs dir
        dir_docs = Path(dir_prj) / dir_docs

        # no docs folder in template
        if not dir_docs.exists():

            # make dir
            dir_docs.mkdir(parents=True)

            # make img dir
            # NB: the name of this dir is hard-coded in mkdocs (AFAIK)
            # it is used exclusively to serve the favicon.ico
            # paths to readme images, etc, can use a different dir
            img_dir = dir_docs / self._dir_img
            img_dir.mkdir(parents=True)

        # ----------------------------------------------------------------------
        # make index

        # make empty or from readme or don't touch
        self._make_index(dir_prj, use_rm, file_rm, dir_docs)

        # ----------------------------------------------------------------------
        # make api

        # make new api or delete old
        self._make_api(dir_prj, use_api, lst_api_in, dir_api_out, dir_docs)

        # ----------------------------------------------------------------------
        # make img dir

        # dir_img is source (from project main)
        if dir_img:
            # make new img dir or combine
            dir_img_src = Path(dir_prj) / dir_img
            if dir_img_src.exists():
                dir_img_dst = dir_docs / dir_img
                shutil.copytree(dir_img_src, dir_img_dst, dirs_exist_ok=True)

    # --------------------------------------------------------------------------
    # Bake docs using mkdocs
    # --------------------------------------------------------------------------
    def build_docs(self, p_dir_pp_venv, p_dir_prj):
        """
        Bake docs using mkdocs

        Raises:
            cnlib.cnfunctions.CNRunError if bake fails

        Updates and deploys docs using mkdocs.
        """

        # ----------------------------------------------------------------------
        # build docs

        # format cmd using pdoc template dir, output dir, and start dir
        cmd_docs = self.S_CMD_DOC_BUILD.format(p_dir_pp_venv, p_dir_prj)

        # the command to run mkdocs
        try:
            F.run(cmd_docs, shell=True)
        except F.CNRunError as e:
            raise e

    # --------------------------------------------------------------------------
    # Deploy docs using mkdocs
    # --------------------------------------------------------------------------
    def deploy_docs(self, p_dir_pp_venv, p_dir_prj):
        """
        Bake docs using mkdocs

        Raises:
            cnlib.cnfunctions.CNRunError if bake fails

        Updates and deploys docs using mkdocs.
        """

        # ----------------------------------------------------------------------
        # deploy docs

        # format cmd using pdoc template dir, output dir, and start dir
        cmd_docs = self.S_CMD_DOC_DEPLOY.format(p_dir_pp_venv, p_dir_prj)

        # the command to run mkdocs
        try:
            F.run(cmd_docs, shell=True)
        except F.CNRunError as e:
            raise e

    # --------------------------------------------------------------------------
    # Private functions
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Make the home file (index.md)
    # --------------------------------------------------------------------------
    def _make_index(self, dir_prj, use_rm, file_rm, dir_docs):
        """
        Make the home file (index.md)

        Make the index.md file from the README.
        """

        # first check if index exists
        dir_docs_out = Path(dir_prj) / dir_docs
        path_index = dir_docs_out / self._index_name

        # if not exist
        if not path_index.exists():

            # create empty file
            if not use_rm:
                with open(path_index, "w", encoding=self.S_ENCODING) as a_file:
                    a_file.write("Coming soon...")
                return

        # if exist
        else:

            # leave alone
            if not use_rm:
                return

        # ----------------------------------------------------------------------
        # make home page
        # NB: just copy readme.md to index.md
        if use_rm:

            # path to files
            readme_file = Path(dir_prj) / file_rm

            # read input file
            text = ""
            with open(readme_file, "r", encoding=self.S_ENCODING) as a_file:
                text = a_file.read()

            # write file
            with open(path_index, "w", encoding=self.S_ENCODING) as a_file:
                a_file.write(text)

    # --------------------------------------------------------------------------
    # Make the api files
    # --------------------------------------------------------------------------
    def _make_api(self, dir_prj, use_api, lst_api_in, dir_api_out, dir_docs):
        """
        Make the api files

        Make the documents using the specified parameters.
        """

        # sanity check
        if not dir_api_out:
            return

        # find api dir
        dir_prj = Path(dir_prj)
        dir_docs_out = dir_prj / dir_docs
        dir_api_out = dir_docs_out / dir_api_out

        # nuke it if it exists and we changed out mind
        if not use_api and dir_api_out.exists():
            shutil.rmtree(dir_api_out)
            return

        # ----------------------------------------------------------------------

        # gather list of full paths to .py files
        files_out = []

        for item in lst_api_in:

            dir_api = dir_prj / item

            # NB: root is a full path, dirs and files are relative to root
            for root, _root_dirs, root_files in dir_api.walk():

                # convert files into Paths
                files = [root / f for f in root_files]
                files = [
                    f
                    for f in files
                    if f.suffix.lower() == self.S_EXT_IN.lower()
                ]

                # for each file item
                for item in files:
                    files_out.append(item)

        # ----------------------------------------------------------------------
        # make structure

        # nuke / remake the api folder
        if dir_api_out.exists():

            # delete and recreate dir
            shutil.rmtree(dir_api_out)
            dir_api_out.mkdir(parents=True)

        # for each py file
        for f in files_out:

            # make a parent folder in docs (goes in nav bar)
            # NB: basically we find every .py file and get its path relative to
            # project dir
            # then we make a folder with the same relative path, but rel to docs
            # dir
            path_rel = f.relative_to(dir_prj)
            path_doc = dir_api_out / path_rel.parent
            path_doc.mkdir(parents=True, exist_ok=True)

            # create a default file
            # NB: just swap ".py" ext for ".md"
            file_md = path_doc / Path(str(f.stem) + self.S_EXT_OUT)

            # fix rel path into package dot notation
            s_parts = ".".join(path_rel.parts)
            if s_parts.endswith(self.S_EXT_IN):
                s_parts = s_parts.removesuffix(self.S_EXT_IN)

            # format contents of file
            file_fmt = self.S_DEF_FILE.format(f.name, s_parts)
            with open(file_md, "w", encoding=self.S_ENCODING) as a_file:
                a_file.write(file_fmt)</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cnlib.cnmkdocs.CNMkDocs.__init__" class="doc doc-heading">
            <code class="highlight language-python">__init__()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the new object</p>
<p>Initializes a new instance of the class, setting the default values
of its properties, and any other code that needs to run to create a
new object.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
              <pre class="highlight"><code class="language-python">def __init__(self):
    """
    Initialize the new object

    Initializes a new instance of the class, setting the default values
    of its properties, and any other code that needs to run to create a
    new object.
    """

    # NB: DO NOT CHANGE!!!
    self._index_name = "index.md"
    self._dir_img = "img"</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cnmkdocs.CNMkDocs.build_docs" class="doc doc-heading">
            <code class="highlight language-python">build_docs(p_dir_pp_venv, p_dir_prj)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Bake docs using mkdocs</p>
        <p>Updates and deploys docs using mkdocs.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
              <pre class="highlight"><code class="language-python">def build_docs(self, p_dir_pp_venv, p_dir_prj):
    """
    Bake docs using mkdocs

    Raises:
        cnlib.cnfunctions.CNRunError if bake fails

    Updates and deploys docs using mkdocs.
    """

    # ----------------------------------------------------------------------
    # build docs

    # format cmd using pdoc template dir, output dir, and start dir
    cmd_docs = self.S_CMD_DOC_BUILD.format(p_dir_pp_venv, p_dir_prj)

    # the command to run mkdocs
    try:
        F.run(cmd_docs, shell=True)
    except F.CNRunError as e:
        raise e</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cnmkdocs.CNMkDocs.deploy_docs" class="doc doc-heading">
            <code class="highlight language-python">deploy_docs(p_dir_pp_venv, p_dir_prj)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Bake docs using mkdocs</p>
        <p>Updates and deploys docs using mkdocs.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
              <pre class="highlight"><code class="language-python">def deploy_docs(self, p_dir_pp_venv, p_dir_prj):
    """
    Bake docs using mkdocs

    Raises:
        cnlib.cnfunctions.CNRunError if bake fails

    Updates and deploys docs using mkdocs.
    """

    # ----------------------------------------------------------------------
    # deploy docs

    # format cmd using pdoc template dir, output dir, and start dir
    cmd_docs = self.S_CMD_DOC_DEPLOY.format(p_dir_pp_venv, p_dir_prj)

    # the command to run mkdocs
    try:
        F.run(cmd_docs, shell=True)
    except F.CNRunError as e:
        raise e</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cnmkdocs.CNMkDocs.make_docs" class="doc doc-heading">
            <code class="highlight language-python">make_docs(dir_prj, dir_docs, use_rm=False, use_api=False, lst_api_in=None, file_rm=None, dir_api_out=None, dir_img=None)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Docstring for make_docs</p>
<p>:param self: Description
:param dir_prj: Description
:param use_rm: Description
:param use_api: Description
:param lst_api_in: Description
:param file_rm: Description
:param dir_api_out: Description
:param dir_img: Description</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnmkdocs.py</code></summary>
              <pre class="highlight"><code class="language-python">def make_docs(
    self,
    dir_prj,
    dir_docs,
    use_rm=False,
    use_api=False,
    lst_api_in=None,
    file_rm=None,
    dir_api_out=None,
    dir_img=None,
):
    """
    Docstring for make_docs

    :param self: Description
    :param dir_prj: Description
    :param use_rm: Description
    :param use_api: Description
    :param lst_api_in: Description
    :param file_rm: Description
    :param dir_api_out: Description
    :param dir_img: Description
    """

    # NB: mutable lists are only set once, passing an empty list does
    # NUSSING!!!
    # so we pass None to make sure the internal list gets reset
    if not lst_api_in:
        lst_api_in = []

    # ----------------------------------------------------------------------
    # check docs dir for exist

    # find docs dir
    dir_docs = Path(dir_prj) / dir_docs

    # no docs folder in template
    if not dir_docs.exists():

        # make dir
        dir_docs.mkdir(parents=True)

        # make img dir
        # NB: the name of this dir is hard-coded in mkdocs (AFAIK)
        # it is used exclusively to serve the favicon.ico
        # paths to readme images, etc, can use a different dir
        img_dir = dir_docs / self._dir_img
        img_dir.mkdir(parents=True)

    # ----------------------------------------------------------------------
    # make index

    # make empty or from readme or don't touch
    self._make_index(dir_prj, use_rm, file_rm, dir_docs)

    # ----------------------------------------------------------------------
    # make api

    # make new api or delete old
    self._make_api(dir_prj, use_api, lst_api_in, dir_api_out, dir_docs)

    # ----------------------------------------------------------------------
    # make img dir

    # dir_img is source (from project main)
    if dir_img:
        # make new img dir or combine
        dir_img_src = Path(dir_prj) / dir_img
        if dir_img_src.exists():
            dir_img_dst = dir_docs / dir_img
            shutil.copytree(dir_img_src, dir_img_dst, dirs_exist_ok=True)</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../cninstall/" class="btn btn-neutral float-left" title="cninstall.py"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cnpot/" class="btn btn-neutral float-right" title="cnpot.py">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../cninstall/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cnpot/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
