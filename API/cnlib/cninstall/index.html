<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>cninstall.py - CNLib</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">CNLib</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Cnlib</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../cnformatter/" class="dropdown-item">cnformatter.py</a>
</li>
            
<li>
    <a href="../cnfunctions/" class="dropdown-item">cnfunctions.py</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active" aria-current="page">cninstall.py</a>
</li>
            
<li>
    <a href="../cnpot/" class="dropdown-item">cnpot.py</a>
</li>
            
<li>
    <a href="../cntree/" class="dropdown-item">cntree.py</a>
</li>
            
<li>
    <a href="../cnvenv/" class="dropdown-item">cnvenv.py</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Tests</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../tests/cnlib_test/" class="dropdown-item">cnlib_test.py</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../cnfunctions/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../cnpot/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#cninstallpy" class="nav-link">cninstall.py</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#cnlib.cninstall" class="nav-link">cninstall</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#cnlib.cninstall.CNInstall" class="nav-link">CNInstall</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="cninstallpy">cninstall.py</h1>


<div class="doc doc-object doc-module">



<a id="cnlib.cninstall"></a>
    <div class="doc doc-contents first">

        <p>The class to use for installing/uninstalling</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="cnlib.cninstall.CNInstall" class="doc doc-heading">
            <code>CNInstall</code>


</h2>


    <div class="doc doc-contents ">


        <p>The class to use for installing/uninstalling</p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="make_install_cfg(name, version, dict_install, desk=False) (cnlib.cninstall.CNInstall.make_install_cfg)" href="#cnlib.cninstall.CNInstall.make_install_cfg">make_install_cfg</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Make a valid install config file</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="make_uninstall_cfg(name, version, list_uninst, desk=False) (cnlib.cninstall.CNInstall.make_uninstall_cfg)" href="#cnlib.cninstall.CNInstall.make_uninstall_cfg">make_uninstall_cfg</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Make a valid uninstall config file</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fix_desktop_file(desk_file, path_icon, dry=False) (cnlib.cninstall.CNInstall.fix_desktop_file)" href="#cnlib.cninstall.CNInstall.fix_desktop_file">fix_desktop_file</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Fix .desktop file, for paths and such</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="install(dir_assets, path_lib, path_cfg_inst, path_cfg_uninst, dir_usr_inst, dir_venv, path_reqs, dry=False) (cnlib.cninstall.CNInstall.install)" href="#cnlib.cninstall.CNInstall.install">install</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Install the program</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="uninstall(path_cfg, dry=False) (cnlib.cninstall.CNInstall.uninstall)" href="#cnlib.cninstall.CNInstall.uninstall">uninstall</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Uninstall the program</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>
        <p>This class provides functions to create install/uninstall config files, and
performs the install and uninstall operations.</p>







              <details class="quote">
                <summary>Source code in <code>cnlib/cninstall.py</code></summary>
                <pre class="highlight"><code class="language-python">class CNInstall:
    """
    The class to use for installing/uninstalling

    Methods:
        make_install_cfg: Make a valid install config file
        make_uninstall_cfg: Make a valid uninstall config file
        fix_desktop_file: Fix .desktop file, for paths and such
        install: Install the program
        uninstall: Uninstall the program

    This class provides functions to create install/uninstall config files, and
    performs the install and uninstall operations.
    """

    # --------------------------------------------------------------------------
    # Class constants
    # --------------------------------------------------------------------------

    # keys
    S_KEY_INST_NAME = "INST_NAME"
    S_KEY_INST_VER = "INST_VER"
    S_KEY_INST_DESK = "INST_DESK"
    S_KEY_INST_CONT = "INST_CONT"

    # --------------------------------------------------------------------------

    # messages
    # NB: format params are prog_name and prog_version
    S_MSG_INST_START = "Installing {} Version {}"
    # NB: format param is prog_name
    S_MSG_INST_END = "{} installed"
    # NB: format param is prog_name
    S_MSG_UNINST_START = "Uninstalling {}"
    # NB: format param is prog_name
    S_MSG_UNINST_END = "{} uninstalled"
    S_MSG_DONE = "Done"
    S_MSG_FAIL = "Fail"

    # strings for system requirements

    S_MSG_COPY_START = "Copying files... "
    S_MSG_DEL_START = "Deleting files... "
    S_MSG_VENV_START = "Making venv folder... "
    S_MSG_REQS_START = "Installing requirements... "
    S_MSG_LIBS_START = "Installing libs... "
    S_MSG_DSK_START = "Fixing .desktop file... "
    S_MSG_VER_ABORT = "Installation aborted"

    # errors
    S_ERR_NO_SUDO = "Could not get sudo permission"
    # NB: format param is source path
    S_ERR_SRC_PATH = "src can not be {}"
    # NB: format param is dest path
    S_ERR_DST_PATH = "dst can not be {}"

    # debug option strings
    S_DRY_OPTION = "-d"
    S_DRY_ACTION = "store_true"
    S_DRY_DEST = "DBG_DEST"
    S_DRY_HELP = "do a dry run, printing file info instead of modifying it"

    # questions
    S_ASK_YES = "y"
    S_ASK_NO = "N"
    S_ASK_VER_SAME = "The current version of this program is already \
     installed. Do you  want to overwrite?"
    S_ASK_VER_OLDER = "A newer version of this program is currently \
    installed. Do you want to overwrite?"

    # --------------------------------------------------------------------------

    # NB: format param is path to icon
    S_DRY_DESK_ICON = "desktop_icon: {}"

    # commands
    # NB: format param is dir_venv
    S_CMD_CREATE = "python -Xfrozen_modules=off -m venv {}"
    # NB: format params are path to prj, path to venv, and path to reqs file
    S_CMD_INSTALL = "cd {};. {}/bin/activate;python -m pip install -r {}"
    # NB: format params are path to prj, path to venv
    S_CMD_VENV_ACTIVATE = "cd {};. {}/bin/activate"
    # NB: format param is name of lib
    S_CMD_INST_LIB = "python -m pip install {}"

    # regex for adding user's home to icon path
    R_ICON_SCH = r"^(Icon=)(.*)$"
    R_ICON_REP = r"\g&lt;1&gt;{}"  # Icon=&lt;home/__PP_IMG_DESK__&gt;

    # --------------------------------------------------------------------------
    # Class methods
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Initialize the class
    # --------------------------------------------------------------------------
    def __init__(self):
        """
        Initialize the class

        Creates a new instance of the object and initializes its properties.
        """

        # set properties
        self._dry = False
        self._dict_cfg = {}

    # --------------------------------------------------------------------------
    # Public methods
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Make a valid install config file
    # --------------------------------------------------------------------------
    def make_install_cfg(self, name, version, dict_install, desk=False):
        """
        Make a valid install config file

        Args:
            name: Program name
            version: New version number to compare to any installed version
            dict_install: Dict of assets to install
            desk:Whether to make a .desktop file for the program

        Returns:
            A properly formatted install config dict to save to a file

        This method creates a config file for use by install.py. The dict
        format can be found below.
        """

        # create the dict using args
        dict_use = {
            self.S_KEY_INST_NAME: name,
            self.S_KEY_INST_VER: version,
            self.S_KEY_INST_DESK: desk,
            self.S_KEY_INST_CONT: dict_install,
        }

        # return the formatted dict
        return dict_use

    # --------------------------------------------------------------------------
    # Make a valid uninstall config file
    # --------------------------------------------------------------------------
    def make_uninstall_cfg(self, name, version, list_uninst, desk=False):
        """
        Make a valid uninstall config file

        Args:
            name: Program name
            version: Initial program version from pyplate.py
            list_uninstall: List of assets to uninstall
            desk: Whether to delete a .desktop file for the program

        Returns:
            A properly formatted uninstall config dict to save to a file

        This method creates a config file for use by uninstall.py. The dict
        format can be found below.
        """

        # create the dict using args
        dict_use = {
            self.S_KEY_INST_NAME: name,
            self.S_KEY_INST_VER: version,
            self.S_KEY_INST_DESK: desk,
            self.S_KEY_INST_CONT: list_uninst,
        }

        # return the formatted dict
        return dict_use

    # --------------------------------------------------------------------------
    # Fix .desktop file, for paths and such
    # --------------------------------------------------------------------------
    def fix_desktop_file(self, desk_file, path_icon, dry=False):
        """
        Fix .desktop file, for paths and such

        Args:
            desk_file: The path to the desktop file to be modified
            path_icon: The path to the program's icon, relative to user home
            dry: If True, do not copy files, ony print the action (default:
            False)

        Fixes entries in the .desktop file (absolute paths, etc.)
        Currently only fixes absolute path to icon.
        """

        # sanity check
        # NB: in a cli or pkg, this file will not exist
        if not desk_file.exists():
            return

        # print info
        print(self.S_MSG_DSK_START, end="", flush=True)

        # open file
        text = ""
        with open(desk_file, "r", encoding="UTF-8") as a_file:
            text = a_file.read()

        # find icon line and fix
        res = re.search(self.R_ICON_SCH, text, flags=re.M)
        if res:

            # get user's home and path to icon rel to prj
            path_icon = Path.home() / path_icon

            # fix abs path to icon
            r_icon_rep = self.R_ICON_REP.format(path_icon)
            text = re.sub(self.R_ICON_SCH, r_icon_rep, text, flags=re.M)

            # ----------------------------------------------------------------------

            # don't mess with file
            if dry:
                print(self.S_DRY_DESK_ICON.format(path_icon))
                return

            # write fixed text back to file
            with open(desk_file, "w", encoding="UTF-8") as a_file:
                a_file.write(text)

    # --------------------------------------------------------------------------
    # Install the program
    # --------------------------------------------------------------------------
    def install(
        self,
        dir_assets,
        path_lib,
        path_cfg_inst,
        path_cfg_uninst,
        dir_usr_inst,
        dir_venv,
        path_reqs,
        dry=False,
    ):
        """
        Install the program

        Args:
            dir_assets: Path to the assets folder where all of the program
            files are put in dist. This is the base source path to use when
            copying files to the user's computer
            path_lib: Path to the dist's lib folder, ie. "assets/lib"
            path_cfg_inst: Path to the file that contains the current install
            dict info
            path_cfg_uninst: Path to the currently installed program's
            uninstall dict info
            dir_usr_inst: The program's install folder in which to make a venv
            dir_venv: The path to the venv folder to create
            path_reqs: Path to the requirements.txt file to add requirements to
            the venv
            dry: If True, do not copy files, ony print the action (default:
            False)

        Runs the install operation.
        """

        # set properties
        self._dry = dry

        # get install dict
        self._dict_cfg = F.get_dict_from_file(path_cfg_inst)

        # get prg name/version
        prog_name = self._dict_cfg[self.S_KEY_INST_NAME]
        prog_version = self._dict_cfg[self.S_KEY_INST_VER]

        # print start msg
        print()
        print(self.S_MSG_INST_START.format(prog_name, prog_version))

        # ----------------------------------------------------------------------
        # draw the rest of the owl

        self._check_version(path_cfg_uninst)

        # make the venv on the user's comp
        self._make_venv(dir_usr_inst, dir_venv)

        # install reqs
        self._install_reqs(dir_usr_inst, dir_venv, path_reqs)

        # install libs
        self._install_libs(dir_usr_inst, dir_venv, path_lib)

        # move content
        self._do_install_content(dir_assets)

        print(self.S_MSG_INST_END.format(prog_name))

    # --------------------------------------------------------------------------
    # Uninstall the program
    # --------------------------------------------------------------------------
    def uninstall(self, path_cfg, dry=False):
        """
        Uninstall the program

        Args:
            path_cfg: Path to the file that contains the uninstall dict info
            dry: If True, do not remove files, ony print the action (default:
            False)

        Runs the uninstall operation.
        """

        # set properties
        self._dry = dry

        # get dict from file
        self._dict_cfg = F.get_dict_from_file(path_cfg)

        # get prg name
        prog_name = self._dict_cfg[self.S_KEY_INST_NAME]

        # print
        print()
        print(self.S_MSG_UNINST_START.format(prog_name))

        # uninstall
        self._do_uninstall_content()
        print(self.S_MSG_UNINST_END.format(prog_name))

    # --------------------------------------------------------------------------
    # Private methods
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Check the version installed vs version to be installed
    # --------------------------------------------------------------------------
    def _check_version(self, path_cfg_uninst):
        """
        Check the version installed vs version to be installed
        """

        # ----------------------------------------------------------------------
        # check for existing/old version

        # if we did pass an old conf, it must exist (if it doesn't, this could
        # be the first install but we will want to check on later updates)
        if path_cfg_uninst and Path(path_cfg_uninst).exists():
            dict_cfg_old = F.get_dict_from_file(path_cfg_uninst)

            # check versions
            ver_old = dict_cfg_old[self.S_KEY_INST_VER]
            ver_new = self._dict_cfg[self.S_KEY_INST_VER]
            res = F.comp_sem_ver(ver_old, ver_new)

            # same version is installed
            if res == F.S_VER_SAME:

                # ask to install same version
                str_ask = F.dialog(
                    self.S_ASK_VER_SAME,
                    [self.S_ASK_YES, self.S_ASK_NO],
                    self.S_ASK_NO,
                )

                # user hit enter or typed "n/N"
                if str_ask == self.S_ASK_NO:
                    print(self.S_MSG_VER_ABORT)
                    sys.exit()

            # newer version is installed
            elif res == F.S_VER_OLDER:

                # ask to install old version over newer
                str_ask = F.dialog(
                    self.S_ASK_VER_OLDER,
                    [self.S_ASK_YES, self.S_ASK_NO],
                    self.S_ASK_NO,
                )

                # user hit enter or typed "n/N"
                if str_ask == F.S_ASK_NO:
                    print(self.S_MSG_VER_ABORT)
                    sys.exit()

    # --------------------------------------------------------------------------
    # Make venv for this program on user's computer
    # --------------------------------------------------------------------------
    def _make_venv(self, dir_usr_inst, dir_venv):
        """
        Make venv for this program on user's computer

        Args:
            dir_usr_inst: The program's install folder in which to make a venv
            folder.
            dir_venv: The path to the venv folder to create.

        Raises:
            cnlib.cnfunctions.CNRunError if the venv creation fails

        Makes a .venv-XXX folder on the user's computer.
        """

        # show progress
        print(self.S_MSG_VENV_START, flush=True, end="")

        # sanity check
        dir_venv = Path(dir_venv)
        if not dir_venv.is_absolute():
            dir_venv = Path(dir_usr_inst) / dir_venv

        # the command to create a venv
        cmd = self.S_CMD_CREATE.format(dir_venv)

        # if it's a dry run, don't make venv
        if self._dry:
            print("\nvenv cmd:", cmd)
            print(self.S_MSG_DONE, "\n")
            return

        # the cmd to create the venv
        try:
            F.run(cmd, shell=True)
            print(self.S_MSG_DONE)
        except F.CNRunError as e:
            print(self.S_MSG_FAIL)
            raise e

    # --------------------------------------------------------------------------
    # Install requirements.txt
    # --------------------------------------------------------------------------
    def _install_reqs(self, dir_usr_inst, dir_venv, path_reqs):
        """
        Install requirements.txt

        Args:
            dir_usr_inst: The program's install folder in which the venv
            resides
            dir_venv: The path tp the venv folder to create
            path_reqs: Path to the requirements.txt file to add requirements to
            the venv

        Raises:
            cnlib.cnfunctions.CNRunError if the reqs install fails

        Installs the contents of a requirements.txt file into the program's
        venv.
        """

        # show progress
        print(self.S_MSG_REQS_START, end="", flush=True)

        # sanity check
        dir_venv = Path(dir_venv)
        if not dir_venv.is_absolute():
            dir_venv = Path(dir_usr_inst) / dir_venv

        # if param is not abs, make abs rel to prj dir
        path_reqs = Path(path_reqs)
        if not path_reqs.is_absolute():
            path_reqs = Path(dir_usr_inst) / path_reqs

        # the command to install packages to venv from reqs
        cmd = self.S_CMD_INSTALL.format(
            dir_venv.parent, dir_venv.name, path_reqs
        )

        # if it's a dry run, don't install
        if self._dry:
            print("\nreqs cmd:", cmd)
            print(self.S_MSG_DONE, "\n")
            return

        # the cmd to install the reqs
        try:
            F.run(cmd, shell=True)
            print(self.S_MSG_DONE)
        except F.CNRunError as e:
            print(self.S_MSG_FAIL)
            raise e

    # --------------------------------------------------------------------------
    # Install libs to program's venv
    # --------------------------------------------------------------------------
    def _install_libs(self, dir_usr_inst, dir_venv, dir_lib):
        """
        Install libs to program's venv

        Args:
            dir_usr_inst: The program's install folder in which the venv
            resides
            dir_venv: The path tp the venv folder to create
            dir_lib: The path to the folder where the libs reside

        Raises:
            cnlib.cnfunctions.CNRunError if the libs install fails

        Installs the contents of a lib folder in the program's venv.
        """

        # show some info
        print(self.S_MSG_LIBS_START, end="", flush=True)

        # sanity check
        dir_venv = Path(dir_venv)
        if not dir_venv.is_absolute():
            dir_venv = Path(dir_usr_inst) / dir_venv

        # sanity check
        dir_lib = Path(dir_lib)
        if not dir_lib.is_absolute():
            dir_lib = Path(dir_usr_inst) / dir_lib

        # start the full command
        cmd = self.S_CMD_VENV_ACTIVATE.format(dir_usr_inst, dir_venv)

        # get list of libs for this prj type
        val = [dir_lib / f for f in dir_lib.iterdir() if f.is_dir()]

        # copy libs to command
        for item in val:

            # add lib
            add_str = self.S_CMD_INST_LIB.format(str(item))
            cmd += ";" + add_str

        # if it's a dry run, don't install
        if self._dry:
            print("\nlibs cmd:", cmd)
            print(self.S_MSG_DONE, "\n")
            return

        # the command to install libs
        try:
            F.run(cmd, shell=True)
            print(self.S_MSG_DONE)
        except F.CNRunError as e:
            print(self.S_MSG_FAIL)
            raise e

    # --------------------------------------------------------------------------
    # Copy source files/folders
    # --------------------------------------------------------------------------
    def _do_install_content(self, dir_assets):
        """
        Copy source files/folders

        Args:
            dir_assets: The base dir from which to find install files

        This method copies files and folders from the assets folder of the
        source to their final locations in the user's folder structure.
        """

        # show some info
        print(self.S_MSG_COPY_START, flush=True, end="")

        # add an extra line break
        if self._dry:
            print()

        # content list from dict
        content = self._dict_cfg.get(self.S_KEY_INST_CONT, {})

        # for each key, value
        for k, v in content.items():

            # get full paths of source / destination
            src = dir_assets / k
            dst = Path.home() / v / src.name

            if k in ("", ".", "..", None):
                print(self.S_ERR_SRC_PATH.format(k))
                sys.exit()

            if v in ("", ".", "..") or src.name in ("", ".", ".."):
                print(self.S_ERR_DST_PATH.format(v))
                sys.exit()

            # debug may omit certain assets
            if not src.exists():
                continue

            if self._dry:
                print(f"copy\n{src}\nto\n{dst}\n")
            else:
                # if the source is a dir
                if src.is_dir():
                    shutil.copytree(src, dst, dirs_exist_ok=True)
                else:
                    shutil.copy(src, dst)

        # show some info
        print(self.S_MSG_DONE)

    # --------------------------------------------------------------------------
    # Remove source files/folders
    # --------------------------------------------------------------------------
    def _do_uninstall_content(self):
        """
        Remove source files/folders

        This method removes files and folders from various locations in the
        user's computer.
        """

        # show some info
        print(self.S_MSG_DEL_START, flush=True, end="")

        # make pretty
        if self._dry:
            print()

        # content list from dict
        content = self._dict_cfg.get(self.S_KEY_INST_CONT, [])

        # for each key, value
        for item in content:

            # weed out relative paths
            if item in ("", ".", ".."):
                print(self.S_ERR_DST_PATH.format(item))
                sys.exit()

            # get full path of destination
            src = Path.home() / item

            # debug may omit certain assets
            if not src.exists():
                continue

            # (maybe) do delete
            if self._dry:
                print(f"remove\n{item}\n")
            else:

                # if the source is a dir
                if src.is_dir():
                    # remove dir
                    shutil.rmtree(src)

                # if the source is a file
                else:
                    # copy file
                    src.unlink()

        # show some info
        print(self.S_MSG_DONE)</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cnlib.cninstall.CNInstall.__init__" class="doc doc-heading">
            <code class="highlight language-python">__init__()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the class</p>
<p>Creates a new instance of the object and initializes its properties.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cninstall.py</code></summary>
              <pre class="highlight"><code class="language-python">def __init__(self):
    """
    Initialize the class

    Creates a new instance of the object and initializes its properties.
    """

    # set properties
    self._dry = False
    self._dict_cfg = {}</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cninstall.CNInstall.fix_desktop_file" class="doc doc-heading">
            <code class="highlight language-python">fix_desktop_file(desk_file, path_icon, dry=False)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Fix .desktop file, for paths and such</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>desk_file</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the desktop file to be modified</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_icon</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the program's icon, relative to user home</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, do not copy files, ony print the action (default:</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Fixes entries in the .desktop file (absolute paths, etc.)
Currently only fixes absolute path to icon.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cninstall.py</code></summary>
              <pre class="highlight"><code class="language-python">def fix_desktop_file(self, desk_file, path_icon, dry=False):
    """
    Fix .desktop file, for paths and such

    Args:
        desk_file: The path to the desktop file to be modified
        path_icon: The path to the program's icon, relative to user home
        dry: If True, do not copy files, ony print the action (default:
        False)

    Fixes entries in the .desktop file (absolute paths, etc.)
    Currently only fixes absolute path to icon.
    """

    # sanity check
    # NB: in a cli or pkg, this file will not exist
    if not desk_file.exists():
        return

    # print info
    print(self.S_MSG_DSK_START, end="", flush=True)

    # open file
    text = ""
    with open(desk_file, "r", encoding="UTF-8") as a_file:
        text = a_file.read()

    # find icon line and fix
    res = re.search(self.R_ICON_SCH, text, flags=re.M)
    if res:

        # get user's home and path to icon rel to prj
        path_icon = Path.home() / path_icon

        # fix abs path to icon
        r_icon_rep = self.R_ICON_REP.format(path_icon)
        text = re.sub(self.R_ICON_SCH, r_icon_rep, text, flags=re.M)

        # ----------------------------------------------------------------------

        # don't mess with file
        if dry:
            print(self.S_DRY_DESK_ICON.format(path_icon))
            return

        # write fixed text back to file
        with open(desk_file, "w", encoding="UTF-8") as a_file:
            a_file.write(text)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cninstall.CNInstall.install" class="doc doc-heading">
            <code class="highlight language-python">install(dir_assets, path_lib, path_cfg_inst, path_cfg_uninst, dir_usr_inst, dir_venv, path_reqs, dry=False)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Install the program</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dir_assets</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the assets folder where all of the program</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_lib</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the dist's lib folder, ie. "assets/lib"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_cfg_inst</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the file that contains the current install</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_cfg_uninst</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the currently installed program's</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dir_usr_inst</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The program's install folder in which to make a venv</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dir_venv</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the venv folder to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_reqs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the requirements.txt file to add requirements to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, do not copy files, ony print the action (default:</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Runs the install operation.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cninstall.py</code></summary>
              <pre class="highlight"><code class="language-python">def install(
    self,
    dir_assets,
    path_lib,
    path_cfg_inst,
    path_cfg_uninst,
    dir_usr_inst,
    dir_venv,
    path_reqs,
    dry=False,
):
    """
    Install the program

    Args:
        dir_assets: Path to the assets folder where all of the program
        files are put in dist. This is the base source path to use when
        copying files to the user's computer
        path_lib: Path to the dist's lib folder, ie. "assets/lib"
        path_cfg_inst: Path to the file that contains the current install
        dict info
        path_cfg_uninst: Path to the currently installed program's
        uninstall dict info
        dir_usr_inst: The program's install folder in which to make a venv
        dir_venv: The path to the venv folder to create
        path_reqs: Path to the requirements.txt file to add requirements to
        the venv
        dry: If True, do not copy files, ony print the action (default:
        False)

    Runs the install operation.
    """

    # set properties
    self._dry = dry

    # get install dict
    self._dict_cfg = F.get_dict_from_file(path_cfg_inst)

    # get prg name/version
    prog_name = self._dict_cfg[self.S_KEY_INST_NAME]
    prog_version = self._dict_cfg[self.S_KEY_INST_VER]

    # print start msg
    print()
    print(self.S_MSG_INST_START.format(prog_name, prog_version))

    # ----------------------------------------------------------------------
    # draw the rest of the owl

    self._check_version(path_cfg_uninst)

    # make the venv on the user's comp
    self._make_venv(dir_usr_inst, dir_venv)

    # install reqs
    self._install_reqs(dir_usr_inst, dir_venv, path_reqs)

    # install libs
    self._install_libs(dir_usr_inst, dir_venv, path_lib)

    # move content
    self._do_install_content(dir_assets)

    print(self.S_MSG_INST_END.format(prog_name))</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cninstall.CNInstall.make_install_cfg" class="doc doc-heading">
            <code class="highlight language-python">make_install_cfg(name, version, dict_install, desk=False)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Make a valid install config file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Program name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New version number to compare to any installed version</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dict_install</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict of assets to install</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>desk</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to make a .desktop file for the program</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A properly formatted install config dict to save to a file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>This method creates a config file for use by install.py. The dict
format can be found below.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cninstall.py</code></summary>
              <pre class="highlight"><code class="language-python">def make_install_cfg(self, name, version, dict_install, desk=False):
    """
    Make a valid install config file

    Args:
        name: Program name
        version: New version number to compare to any installed version
        dict_install: Dict of assets to install
        desk:Whether to make a .desktop file for the program

    Returns:
        A properly formatted install config dict to save to a file

    This method creates a config file for use by install.py. The dict
    format can be found below.
    """

    # create the dict using args
    dict_use = {
        self.S_KEY_INST_NAME: name,
        self.S_KEY_INST_VER: version,
        self.S_KEY_INST_DESK: desk,
        self.S_KEY_INST_CONT: dict_install,
    }

    # return the formatted dict
    return dict_use</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cninstall.CNInstall.make_uninstall_cfg" class="doc doc-heading">
            <code class="highlight language-python">make_uninstall_cfg(name, version, list_uninst, desk=False)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Make a valid uninstall config file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Program name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial program version from pyplate.py</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>list_uninstall</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of assets to uninstall</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>desk</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to delete a .desktop file for the program</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A properly formatted uninstall config dict to save to a file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>This method creates a config file for use by uninstall.py. The dict
format can be found below.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cninstall.py</code></summary>
              <pre class="highlight"><code class="language-python">def make_uninstall_cfg(self, name, version, list_uninst, desk=False):
    """
    Make a valid uninstall config file

    Args:
        name: Program name
        version: Initial program version from pyplate.py
        list_uninstall: List of assets to uninstall
        desk: Whether to delete a .desktop file for the program

    Returns:
        A properly formatted uninstall config dict to save to a file

    This method creates a config file for use by uninstall.py. The dict
    format can be found below.
    """

    # create the dict using args
    dict_use = {
        self.S_KEY_INST_NAME: name,
        self.S_KEY_INST_VER: version,
        self.S_KEY_INST_DESK: desk,
        self.S_KEY_INST_CONT: list_uninst,
    }

    # return the formatted dict
    return dict_use</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cninstall.CNInstall.uninstall" class="doc doc-heading">
            <code class="highlight language-python">uninstall(path_cfg, dry=False)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Uninstall the program</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_cfg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the file that contains the uninstall dict info</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, do not remove files, ony print the action (default:</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Runs the uninstall operation.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cninstall.py</code></summary>
              <pre class="highlight"><code class="language-python">def uninstall(self, path_cfg, dry=False):
    """
    Uninstall the program

    Args:
        path_cfg: Path to the file that contains the uninstall dict info
        dry: If True, do not remove files, ony print the action (default:
        False)

    Runs the uninstall operation.
    """

    # set properties
    self._dry = dry

    # get dict from file
    self._dict_cfg = F.get_dict_from_file(path_cfg)

    # get prg name
    prog_name = self._dict_cfg[self.S_KEY_INST_NAME]

    # print
    print()
    print(self.S_MSG_UNINST_START.format(prog_name))

    # uninstall
    self._do_uninstall_content()
    print(self.S_MSG_UNINST_END.format(prog_name))</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
