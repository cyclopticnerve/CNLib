<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>cnvenv.py - CNLib</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "cnvenv.py";
        var mkdocs_page_input_path = "API/cnlib/cnvenv.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> CNLib
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Cnlib</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../cnformatter/">cnformatter.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cnfunctions/">cnfunctions.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cninstall/">cninstall.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cnmkdocs/">cnmkdocs.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cnpot/">cnpot.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cntree/">cntree.py</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">cnvenv.py</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#cnlib.cnvenv">cnvenv</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cnlib.cnvenv.CNVenv">CNVenv</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cnlib.cnvenv.CNVenv.__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cnlib.cnvenv.CNVenv.create">create</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cnlib.cnvenv.CNVenv.freeze">freeze</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cnlib.cnvenv.CNVenv.install_reqs">install_reqs</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">CNLib</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API</li>
          <li class="breadcrumb-item">Cnlib</li>
      <li class="breadcrumb-item active">cnvenv.py</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cnvenvpy">cnvenv.py</h1>


<div class="doc doc-object doc-module">



<a id="cnlib.cnvenv"></a>
    <div class="doc doc-contents first">

        <p>A class to make handling of venv folders easier</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="cnlib.cnvenv.CNVenv" class="doc doc-heading">
            <code>CNVenv</code>


</h2>


    <div class="doc doc-contents ">


        <p>A class to make handling of venv folders easier</p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="create() (cnlib.cnvenv.CNVenv.create)" href="#cnlib.cnvenv.CNVenv.create">create</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Creates a new venv given the <strong>init</strong> params</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="install_reqs(file_reqs) (cnlib.cnvenv.CNVenv.install_reqs)" href="#cnlib.cnvenv.CNVenv.install_reqs">install_reqs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Install packages to venv from the reqs_file property</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="freeze(file_reqs) (cnlib.cnvenv.CNVenv.freeze)" href="#cnlib.cnvenv.CNVenv.freeze">freeze</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Freeze packages in the venv folder to the file_reqs property</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>
        <p>This class provides methods to create, freeze, and install dependencies
in the project's venv folder.</p>







              <details class="quote">
                <summary>Source code in <code>cnlib/cnvenv.py</code></summary>
                <pre class="highlight"><code class="language-python">class CNVenv:
    """
    A class to make handling of venv folders easier

    Methods:
        create: Creates a new venv given the __init__ params
        install_reqs: Install packages to venv from the reqs_file property
        freeze: Freeze packages in the venv folder to the file_reqs property

    This class provides methods to create, freeze, and install dependencies
    in the project's venv folder.
    """

    # --------------------------------------------------------------------------
    # Class constants
    # --------------------------------------------------------------------------

    # NB format param is self._dir_venv
    S_CMD_CREATE = "python -Xfrozen_modules=off -m venv {}"
    # NB: format params are venv.parent, venv.name, path to reqs file
    S_CMD_INSTALL = "cd {};. {}/bin/activate;python -m pip install -r {}"
    # NB: format params are venv.parent, venv.name, path to reqs file
    S_CMD_FREEZE = (
        "cd {}; "
        ". {}/bin/activate; "
        "python "
        "-Xfrozen_modules=off "
        "-m pip freeze "
        "-l --exclude-editable "
        "--require-virtualenv "
        "&gt; "
        "{}"
    )

    # error messages
    # NB: format param is dir_prj
    S_ERR_NOT_ABS = "path {} is not absolute"
    # NB: format param is dir_prj
    S_ERR_NOT_DIR = "path {} is not a directory"

    # --------------------------------------------------------------------------
    # Class methods
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Initialize the new object
    # --------------------------------------------------------------------------
    def __init__(self, dir_prj, dir_venv):
        """
        Initialize the new object

        Args:
            dir_prj: The path to the project's root dir (can be a string or a
            Path object)
            dir_venv: The path or name of the resulting venv folder (can be a
            string or a Path object, absolute or relative to dir_prj)

        Initializes a new instance of the class, setting the default values of
        its properties, and any other code needed to create a new object.
        """

        # save prj dir
        self._dir_prj = Path(dir_prj)
        if not self._dir_prj.is_absolute():
            raise OSError(self.S_ERR_NOT_ABS.format(self._dir_prj))
        if not self._dir_prj.is_dir():
            raise OSError(self.S_ERR_NOT_DIR.format(self._dir_prj))

        # if param is not abs, make abs rel to prj dir
        self._dir_venv = Path(dir_venv)
        if not self._dir_venv.is_absolute():
            self._dir_venv = self._dir_prj / dir_venv

    # --------------------------------------------------------------------------
    # Public methods
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Creates a new venv given the __init__ params
    # --------------------------------------------------------------------------
    def create(self):
        """
        Creates a new venv given the __init__ params

        Raises:
            cnlib.cnfunctions.CNRunError if the create fails

        Creates a new venv folder with the parameters provided at create time.
        """

        # the command to create a venv
        cmd = self.S_CMD_CREATE.format(self._dir_venv)
        try:
            F.run(cmd, shell=True)
        except F.CNRunError as e:
            raise e

    # --------------------------------------------------------------------------
    # Install packages to venv from the reqs_file property
    # --------------------------------------------------------------------------
    def install_reqs(self, file_reqs):
        """
        Install packages to venv from the reqs_file property

        Args:
            file_reqs: File to load requirements

        Raises:
            cnlib.cnfunctions.CNRunError if the reqs install fails

        This method takes requirements in the reqs_file property and installs
        them in the dir_venv property.
        """

        # if param is not abs, make abs rel to prj dir
        file_reqs = Path(file_reqs)
        if not file_reqs.is_absolute():
            file_reqs = self._dir_prj / file_reqs

        # ignore missing/empty files
        if not file_reqs.exists() or file_reqs.stat().st_size == 0:
            return

        # the command to install packages to venv from reqs
        cmd = self.S_CMD_INSTALL.format(
            self._dir_venv.parent, self._dir_venv.name, file_reqs
        )
        try:
            F.run(cmd, shell=True)
        except F.CNRunError as e:
            raise e

    # --------------------------------------------------------------------------
    # Freeze packages in the venv folder to the file_reqs property
    # --------------------------------------------------------------------------
    def freeze(self, file_reqs):
        """
        Freeze packages in the venv folder to the file_reqs property

        Args:
            file_reqs: File to save requirements

        Raises:
            cnlib.cnfunctions.CNRunError if the freeze fails

        Freezes current packages in the venv dir into a file for easy
        installation.
        """

        # if param is not abs, make abs rel to prj dir
        file_reqs = Path(file_reqs)
        if not file_reqs.is_absolute():
            file_reqs = self._dir_prj / file_reqs

        # the command to freeze a venv
        cmd = self.S_CMD_FREEZE.format(
            self._dir_venv.parent, self._dir_venv.name, file_reqs
        )
        try:
            F.run(cmd, shell=True)
        except F.CNRunError as e:
            raise e</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cnlib.cnvenv.CNVenv.__init__" class="doc doc-heading">
            <code class="highlight language-python">__init__(dir_prj, dir_venv)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the new object</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>dir_prj</code></b>
              –
              <div class="doc-md-description">
                <p>The path to the project's root dir (can be a string or a</p>
              </div>
            </li>
            <li>
              <b><code>dir_venv</code></b>
              –
              <div class="doc-md-description">
                <p>The path or name of the resulting venv folder (can be a</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Initializes a new instance of the class, setting the default values of
its properties, and any other code needed to create a new object.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnvenv.py</code></summary>
              <pre class="highlight"><code class="language-python">def __init__(self, dir_prj, dir_venv):
    """
    Initialize the new object

    Args:
        dir_prj: The path to the project's root dir (can be a string or a
        Path object)
        dir_venv: The path or name of the resulting venv folder (can be a
        string or a Path object, absolute or relative to dir_prj)

    Initializes a new instance of the class, setting the default values of
    its properties, and any other code needed to create a new object.
    """

    # save prj dir
    self._dir_prj = Path(dir_prj)
    if not self._dir_prj.is_absolute():
        raise OSError(self.S_ERR_NOT_ABS.format(self._dir_prj))
    if not self._dir_prj.is_dir():
        raise OSError(self.S_ERR_NOT_DIR.format(self._dir_prj))

    # if param is not abs, make abs rel to prj dir
    self._dir_venv = Path(dir_venv)
    if not self._dir_venv.is_absolute():
        self._dir_venv = self._dir_prj / dir_venv</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cnvenv.CNVenv.create" class="doc doc-heading">
            <code class="highlight language-python">create()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a new venv given the <strong>init</strong> params</p>
        <p>Creates a new venv folder with the parameters provided at create time.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnvenv.py</code></summary>
              <pre class="highlight"><code class="language-python">def create(self):
    """
    Creates a new venv given the __init__ params

    Raises:
        cnlib.cnfunctions.CNRunError if the create fails

    Creates a new venv folder with the parameters provided at create time.
    """

    # the command to create a venv
    cmd = self.S_CMD_CREATE.format(self._dir_venv)
    try:
        F.run(cmd, shell=True)
    except F.CNRunError as e:
        raise e</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cnvenv.CNVenv.freeze" class="doc doc-heading">
            <code class="highlight language-python">freeze(file_reqs)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Freeze packages in the venv folder to the file_reqs property</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_reqs</code></b>
              –
              <div class="doc-md-description">
                <p>File to save requirements</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Freezes current packages in the venv dir into a file for easy
installation.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnvenv.py</code></summary>
              <pre class="highlight"><code class="language-python">def freeze(self, file_reqs):
    """
    Freeze packages in the venv folder to the file_reqs property

    Args:
        file_reqs: File to save requirements

    Raises:
        cnlib.cnfunctions.CNRunError if the freeze fails

    Freezes current packages in the venv dir into a file for easy
    installation.
    """

    # if param is not abs, make abs rel to prj dir
    file_reqs = Path(file_reqs)
    if not file_reqs.is_absolute():
        file_reqs = self._dir_prj / file_reqs

    # the command to freeze a venv
    cmd = self.S_CMD_FREEZE.format(
        self._dir_venv.parent, self._dir_venv.name, file_reqs
    )
    try:
        F.run(cmd, shell=True)
    except F.CNRunError as e:
        raise e</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cnlib.cnvenv.CNVenv.install_reqs" class="doc doc-heading">
            <code class="highlight language-python">install_reqs(file_reqs)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Install packages to venv from the reqs_file property</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_reqs</code></b>
              –
              <div class="doc-md-description">
                <p>File to load requirements</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>This method takes requirements in the reqs_file property and installs
them in the dir_venv property.</p>


            <details class="quote">
              <summary>Source code in <code>cnlib/cnvenv.py</code></summary>
              <pre class="highlight"><code class="language-python">def install_reqs(self, file_reqs):
    """
    Install packages to venv from the reqs_file property

    Args:
        file_reqs: File to load requirements

    Raises:
        cnlib.cnfunctions.CNRunError if the reqs install fails

    This method takes requirements in the reqs_file property and installs
    them in the dir_venv property.
    """

    # if param is not abs, make abs rel to prj dir
    file_reqs = Path(file_reqs)
    if not file_reqs.is_absolute():
        file_reqs = self._dir_prj / file_reqs

    # ignore missing/empty files
    if not file_reqs.exists() or file_reqs.stat().st_size == 0:
        return

    # the command to install packages to venv from reqs
    cmd = self.S_CMD_INSTALL.format(
        self._dir_venv.parent, self._dir_venv.name, file_reqs
    )
    try:
        F.run(cmd, shell=True)
    except F.CNRunError as e:
        raise e</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../cntree/" class="btn btn-neutral float-left" title="cntree.py"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../cntree/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
