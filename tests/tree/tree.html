<!DOCTYPE html>
<html>
    <head>
        <style>
            ul {
                list-style-type: none;
                padding-left: 20px;
            }
        </style>
    </head>
    <body>
        <ul>
            <li>
                <input type="checkbox" id="tree">
                <label for="tree">tree/</label>
                <ul>
                    <li>
                        <input type='checkbox' id='tree.foo'>
                        <label for='tree.foo'> foo/</label>
                        <ul>
                            <li>
                                <input type='checkbox' id='tree.foo.foo1'>
                                <label for='tree.foo.foo1'> foo1/</label>
                                <ul>
                                    <li>
                                        <input type='checkbox' id='tree.foo.foo1.foo1.txt'>
                                        <label for='tree.foo.foo1.foo1.txt'> foo1.txt</label>
                                        <ul>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <input type='checkbox' id='tree.foo.foo2'>
                                <label for='tree.foo.foo2'> foo2/</label>
                                <ul>
                                    <li>
                                        <input type='checkbox' id='tree.foo.foo2.foo3'>
                                        <label for='tree.foo.foo2.foo3'> foo3/</label>
                                        <ul>
                                            <li>
                                                <input type='checkbox' id='tree.foo.foo2.foo3.foo3.txt'>
                                                <label for='tree.foo.foo2.foo3.foo3.txt'> foo3.txt</label>
                                                <ul>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <input type='checkbox' id='tree.foo.bar.txt'>
                                <label for='tree.foo.bar.txt'> bar.txt</label>
                                <ul>
                                </ul>
                            </li>
                            <li>
                                <input type='checkbox' id='tree.foo.bar1.txt'>
                                <label for='tree.foo.bar1.txt'> bar1.txt</label>
                                <ul>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <input type='checkbox' id='tree.tree.html'>
                        <label for='tree.tree.html'> tree.html</label>
                        <ul>
                        </ul>
                    </li>
                    <li>
                        <input type='checkbox' id='tree.tree.py'>
                        <label for='tree.tree.py'> tree.py</label>
                        <ul>
                        </ul>
                    </li>
                    <li>
                        <input type='checkbox' id='tree.tree.txt'>
                        <label for='tree.tree.txt'> tree.txt</label>
                        <ul>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        <script>

            // NB: https://codepen.io/girish/pen/BaWMGKp

            // helper func to create a flat array from a NodeList
            nodeArray = (parent, selector) =>
                Array.from(parent.querySelectorAll(selector));

            // get all checkboxes from document
            allChecks = nodeArray(document, 'input[type="checkbox"]');

            // global document listener (add to all inputs)
            addEventListener('change', e => {

                // get object that changed
                check = e.target;

                // if event did not come from a checkbox in our list
                if (allChecks.indexOf(check) === -1)
                    return;

                // check/uncheck children based on parent state
                parent = check.parentNode;
                children = nodeArray(parent, 'input[type="checkbox"]');
                children.forEach(child =>
                    child.checked = check.checked
                );

                // traverse up from target check
                while (check) {

                    // find parent checkbox
                    parent = check.closest('ul');
                    parent = parent.parentNode;
                    parent = parent.querySelector('input[type="checkbox"]');

                    // find sibling checkboxes
                    siblings = parent.closest('li');
                    siblings = siblings.querySelector('ul');
                    siblings = nodeArray(siblings, 'input[type="checkbox"]');

                    // get checked state of siblings
                    // are every or some siblings checked?
                    siblingsMap = siblings.map(check => check.checked);
                    every = siblingsMap.every(Boolean);
                    some = siblingsMap.some(Boolean);

                    // check parent if all child siblings are checked
                    // set indeterminate if some (not all and not none) are checked
                    parent.checked = every;
                    parent.indeterminate = !every && every !== some;

                    // prepare for next loop
                    check = check != parent ? parent : 0;
                }

                // save current state
                save();
            });

            // save current state
            function save() {

                // for each checkbox
                allChecks.forEach(check => {

                    // get all the stuff
                    id = check.id;
                    ind = check.indeterminate;
                    checked = check.checked;

                    // if it is -, save that
                    if (ind) {
                        localStorage.setItem(id, 'ind');

                        // not -, save checked or not
                    } else {
                        localStorage.setItem(id, checked);
                    }
                });
            };

            // load previous state
            window.onload = function () {

                // for each checkbox
                allChecks.forEach(check => {

                    // get all the stuff
                    id = check.id;
                    ind = localStorage.getItem(id) === 'ind';
                    checked = localStorage.getItem(id) === 'true';

                    // if it was -, set to -
                    if (ind) {
                        check.indeterminate = true

                    // if it was not -, set to old state
                    } else {
                        check.checked = checked;
                    }
                });
            };

        </script>
    </body>
</html>

<!-- -) -->
